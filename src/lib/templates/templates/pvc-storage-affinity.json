{
  "id": "pvc-storage-affinity-v1",
  "name": "PVC Storage Affinity Analysis",
  "version": "1.0.0",
  "triageTarget": "pvc-storage-affinity",
  "triggers": [ { "type": "static_target", "target": "pvc-storage-affinity", "confidence": 1.0 } ],
  "blocks": [],
  "composition": { "infrastructure": [], "workload": [], "correlation": [] },
  "steps": [
    { "tool": "oc_read_describe", "params": { "resourceType": "pvc", "namespace": "<ns>", "name": "<pvc>" }, "rationale": "PVC spec, status, and events" },
    { "tool": "oc_read_describe", "params": { "resourceType": "pv", "name": "<pv|derived>" }, "rationale": "Bound PV zone/labels and status" },
    { "tool": "oc_read_describe", "params": { "resourceType": "storageclass", "name": "<sc|default>" }, "rationale": "StorageClass binding mode and topology keys" },
    { "tool": "oc_read_machinesets", "params": { "sessionId": "<sessionId>", "namespace": "openshift-machine-api", "bounded": true }, "rationale": "Recent scale events to explain timing issues" }
  ],
  "evidenceContract": {
    "version": "v1.0.0",
    "required": [
      "pvcSpec",
      "scInfo",
      "bindingMode",
      "allowedTopologies",
      "waitForFirstConsumer",
      "pvZoneMismatch",
      "provisionerErrors",
      "recentScaleEvents"
    ],
    "selectors": {
      "pvcSpec": [ { "type": "yq", "path": ".spec" }, { "type": "eventsRegex", "path": "PersistentVolumeClaim" } ],
      "scInfo": [ { "type": "yq", "path": ".parameters" }, { "type": "eventsRegex", "path": "StorageClass|provisioner|parameters" } ],
      "bindingMode": [ { "type": "eventsRegex", "path": "WaitForFirstConsumer|Immediate" } ],
      "allowedTopologies": [ { "type": "eventsRegex", "path": "allowedTopologies|topology.kubernetes.io/zone|topology.kubernetes.io/region" } ],
      "waitForFirstConsumer": [ { "type": "eventsRegex", "path": "WaitForFirstConsumer" } ],
      "pvZoneMismatch": [ { "type": "eventsRegex", "path": "no matching topology|no PV found in zone|0/\\d+ nodes are available" } ],
      "provisionerErrors": [ { "type": "eventsRegex", "path": "provisioning failed|timed out waiting|failed to provision|retries exhausted" } ],
      "recentScaleEvents": [ { "type": "eventsRegex", "path": "Scaled up|Scaled down|replicas" } ]
    },
    "completenessThreshold": 0.85
  },
  "boundaries": { "maxSteps": 4, "timeoutMs": 25000 }
}

