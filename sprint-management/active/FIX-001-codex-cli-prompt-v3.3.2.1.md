# CODEX CLI INITIALIZATION PROMPT - FIX-001 MEMORY SYSTEM CRISIS (Process v3.3.2.1 Compliant)\n\n**Process Framework**: Process v3.3.2.1 - Two-Part Prompt Structure  \n**Sprint ID**: FIX-001-memory-system-crisis-restart  \n**Template Compliance**: MANDATORY fixed header + variable domain\n**Quality Standard**: Aviation checklist discipline with zero deviation tolerance  \n\n---\n\n# PART 1: FIXED TEMPLATE HEADER - DAILY REPEATABLE TASKS\n\n**Template Source**: `/sprint-management/templates/daily-repeatable-task-template-v3.3.2.md`  \n**Template Version**: v3.3.2-daily-repeatable  \n**Usage**: Standard foundation for all CODEX CLI sprint prompts - NEVER MODIFY\n\n## MANDATORY GIT WORKFLOW INITIALIZATION\n\n```bash\n# STANDARD START - EVERY SPRINT\ncd /Users/kevinbrown/MCP-ocs\ngit checkout release/v0.9.0-beta\ngit pull origin release/v0.9.0-beta  \ngit checkout -b feature/FIX-001-memory-system-crisis-restart\n\n# VERIFY CLEAN WORKING STATE\ngit status\nnpm run build  # Ensure foundation compiles\n```\n\n**GIT DISCIPLINE DURING SPRINT**:\n- **COMMIT**: Frequent local commits as work progresses\n- **NO PUSH**: Never push during sprint execution \n- **NO MERGE**: End-of-day cleanup handled by Scrum Master + Human\n- **SAFETY**: All work preserved locally on feature branch\n\n## SYSTEMATIC TASK LOGGING FRAMEWORK\n\n**Real-Time Logging Commands** (Use throughout sprint):\n```bash\n# PHASE START LOGGING\necho \"$(date -Iseconds): [TASK] Starting [PHASE-NAME]\" >> logs/sprint-execution.log\n\n# DECISION POINT LOGGING  \necho \"$(date -Iseconds): [DECISION] [Description] - Rationale: [reason]\" >> logs/sprint-execution.log\n\n# EVIDENCE LOGGING\necho \"$(date -Iseconds): [EVIDENCE] [Metric/Test] - Result: [outcome]\" >> logs/sprint-execution.log\n\n# PHASE COMPLETION LOGGING\necho \"$(date -Iseconds): [COMPLETE] [PHASE-NAME] - Evidence: [summary]\" >> logs/sprint-execution.log\n```\n\n**Log Verification Commands**:\n```bash\n# CHECK LOG COMPLETENESS\ntail -20 logs/sprint-execution.log\nwc -l logs/sprint-execution.log  # Line count verification\n```\n\n## DEVELOPER-GUARDRAILS COMPLIANCE VERIFICATION\n\n**Security Pattern Audit Commands** (Run at each phase):\n```bash\n# D-001: Input Validation Check\ngrep -r \"process.env\" src/ | grep -v \"validation\\|schema\"\n\n# D-002: TypeScript Hygiene Audit  \ngrep -r \"any\" src/ | grep -v \"@ts-ignore\" | head -5\n\n# D-005: Async Correctness Check\ngrep -r \"await\" src/ | grep -v \"try\\|catch\" | head -5\n\n# D-006: Error Taxonomy Verification\ngrep -r \"throw new Error\" src/ | head -5\n\n# D-009: Date-Time Safety Audit (CRITICAL)\ngrep -r \"Date.now()\\|new Date()\\|Date.parse()\" src/ || echo \"✅ D-009 Compliant\"\ngrep -r \"nowIso\\|nowEpoch\" src/ | wc -l  # Count proper usage\n```\n\n## PERFORMANCE REQUIREMENTS ENFORCEMENT\n\n**Timing Standards** (Measure all operations):\n```bash\n# OPERATION TIMING TEMPLATE\nSTART_TIME=$(date +%s)\n# [Execute operation]\nEND_TIME=$(date +%s)\nDURATION=$((END_TIME - START_TIME))\necho \"Operation took ${DURATION}s (requirement: <15s)\" >> logs/sprint-execution.log\n```\n\n**Performance Validation Requirements**:\n- Individual operations: <15 seconds\n- Evidence confidence: ≥0.8 for critical validations  \n- Step efficiency: ≤3 steps per validation checkpoint\n- Memory operations: <1000ms store, <400ms search\n\n## SYSTEMATIC PHASE COMPLETION CHECKLIST\n\n**Before Proceeding to Next Phase** (Mandatory verification):\n```bash\n# PHASE COMPLETION VERIFICATION\necho \"Phase Completion Checklist:\"\necho \"[ ] Performance requirements met (<15s operations, ≥0.8 evidence)\"\necho \"[ ] Quality gates passed (≤3 steps per validation)\"\necho \"[ ] Security guardrails verified (D-001, D-002, D-005, D-006, D-009)\"\necho \"[ ] Documentation complete (decision rationale logged)\"\necho \"[ ] Evidence collected (quantitative metrics captured)\"\necho \"[ ] Local commits made (work preserved safely)\"\n```\n\n## EVIDENCE COLLECTION PROTOCOLS\n\n**Quantitative Evidence Requirements**:\n```bash\n# PERFORMANCE EVIDENCE\necho \"Performance Metrics:\" >> logs/evidence-$(date +%Y%m%d).log\necho \"- Operation latency: [Xs] (target: <15s)\" >> logs/evidence-$(date +%Y%m%d).log\necho \"- Test execution time: [Xs] (target: <180s)\" >> logs/evidence-$(date +%Y%m%d).log\n\n# QUALITY EVIDENCE  \necho \"Quality Metrics:\" >> logs/evidence-$(date +%Y%m%d).log\necho \"- Test coverage: [N]% (target: >80%)\" >> logs/evidence-$(date +%Y%m%d).log\necho \"- Security compliance: [N/6] guardrails (target: 6/6)\" >> logs/evidence-$(date +%Y%m%d).log\n```\n\n## ROLE DEFINITIONS & BOUNDARIES\n\n**CODEX PRIMARY EXECUTOR RESPONSIBILITIES**:\n- Systematic phase-based implementation following template\n- Complete evidence collection with quantitative validation\n- Technical decision documentation with rationale logging\n- Performance optimization within established budgets\n- Quality gate compliance before phase progression\n- Local git commits preserving all work safely\n\n**HUMAN OVERSIGHT (SCRUM MASTER) BOUNDARIES**:\n- Strategic decisions requiring business context\n- Scope boundary management and timeline adjustments  \n- Rollback authority for production safety concerns\n- End-of-day git cleanup and merge coordination\n- Process framework compliance verification\n\n**CRITICAL**: CODEX executes systematically, Human handles strategic oversight and git finalization\n\n## QUALITY ASSURANCE INTEGRATION\n\n**Testing Strategy Framework**:\n```bash\n# UNIT TESTING VERIFICATION\nnpm test -- --coverage --testPathPattern=[DOMAIN]\n\n# INTEGRATION TESTING\nnpm run test:integration -- [SPECIFIC-SUITE]\n\n# E2E TESTING (if applicable)\nnpm run test:e2e -- [SCENARIO]\n```\n\n**Code Quality Commands**:\n```bash\n# LINTING VERIFICATION\nnpm run lint -- src/[CHANGED-FILES]\n\n# TYPE CHECKING\nnpm run typecheck\n\n# BUILD VERIFICATION\nnpm run build && echo \"✅ Build successful\" || echo \"❌ Build failed\"\n```\n\n## HANDOFF PREPARATION FRAMEWORK\n\n**TESTER Handoff Package Requirements**:\n- Complete implementation with evidence documentation\n- Performance benchmark results with quantitative metrics\n- Quality gate completion verification logs\n- Security guardrails compliance assessment\n- Testing procedures with expected outcomes\n- Rollback procedures (if applicable)\n\n---\n\n# PART 2: VARIABLE SPRINT DOMAIN - FIX-001 MEMORY SYSTEM CRISIS\n\n**Domain Context**: MCP-OCS Memory System Emergency Architecture Consolidation  \n**Priority**: P0 Production Breaking  \n**Estimated Duration**: 6-8 hours systematic implementation  \n**Aviation Context**: This airport (memory system) has specific challenges requiring bounded local procedures\n\n## CRISIS-SPECIFIC TECHNICAL CONTEXT\n\n### Root Cause Analysis (Vector Memory + GitHub Issue)\n\n**Architecture Crisis Components**:\n1. **Protocol Violations**: ChromaMemoryManager Unicode emoji logs breaking MCP JSON protocol\n2. **Import Resolution Failure**: TypeScript path alias (@/lib) fails at runtime in index.ts\n3. **External Dependency Coupling**: ../../../MCP-files/src/memory-extension.ts breaking clean builds\n4. **Memory System Inconsistency**: Dual write paths causing data integrity issues\n5. **Entry Point Architecture Chaos**: Three entry points with different behaviors\n\n**Proven Working Evidence**:\n- **index-sequential.ts**: Battle-tested by all E2E testing, direct imports, functional memory\n- **index.ts**: Official main but runtime failures due to @/lib path alias resolution\n- **index.beta.ts**: Stable subset, preserved as rollback option\n\n### Memory Crisis Domain Files\n\n**Critical File Locations**:\n- **Protocol Crisis**: `src/lib/memory/mcp-files-memory-extension.ts` (ChromaMemoryManager.log method)\n- **Import Crisis**: `src/lib/memory/shared-memory.ts` (MCPFilesChromaAdapter @/lib import)\n- **Entry Points**: `src/index.ts`, `src/index-sequential.ts`, `src/index.beta.ts`\n- **Memory Chain**: SharedMemoryManager → MCPFilesChromaAdapter → ChromaMemoryManager\n\n## 6-PHASE EMERGENCY CONSOLIDATION STRATEGY\n\n### Phase 0: Guardrails & Baseline Validation (30-45 min)\n- **Objective**: Establish crisis baseline with systematic architecture analysis\n- **Evidence Target**: System status verification, protocol violation confirmation\n- **Success Criteria**: Baseline documented, rollback procedures established\n\n### Phase 1: Protocol Safety & Stdout Elimination (60-90 min)\n- **Objective**: Fix ChromaMemoryManager.log() method for MCP JSON compliance\n- **Technical Decision**: Replace console.log() → console.error() with MCP_PROTOCOL_SAFE flag\n- **Evidence Target**: Zero stdout during server operation (≥0.8 confidence)\n- **Success Criteria**: Protocol smoke test passes, Unicode emoji elimination confirmed\n\n### Phase 2: Remove MCP-files Dependency (90-120 min)\n- **Objective**: Eliminate ../../../MCP-files/ external import coupling\n- **Technical Decision**: Vendor ChromaMemoryManager internally, update import paths\n- **Evidence Target**: Clean npm run build without external dependencies\n- **Success Criteria**: No MCP-files/ imports detected, build succeeds\n\n### Phase 3: Unify Memory Backend (90-120 min)\n- **Objective**: Create UnifiedMemoryAdapter replacing dual write paths\n- **Technical Decision**: Consolidate SharedMemoryManager + ToolMemoryGateway backends\n- **Evidence Target**: Consistent tagging across all write paths, <1000ms store/<400ms search\n- **Success Criteria**: Memory integration tests pass, unified backend functional\n\n### Phase 4: Import Resolution Hardening (45-60 min)\n- **Objective**: Fix TypeScript path alias (@/lib) resolution failures\n- **Technical Decision**: Choose relative imports vs tsconfig-paths runtime resolution\n- **Evidence Target**: Both tsx and compiled execution successful\n- **Success Criteria**: Development/production parity validated, runtime resolution stable\n\n### Phase 5: Validation & E2E Testing (60-90 min)\n- **Objective**: Comprehensive regression testing with production readiness\n- **Evidence Target**: E2E test suite passes without regressions (≥0.8 confidence)\n- **Success Criteria**: All operations within performance budgets, protocol compliant\n\n## DOMAIN-SPECIFIC SUCCESS CRITERIA\n\n**P0 Memory Crisis Resolution**:\n- [ ] Zero stdout output during server operation (protocol compliance)\n- [ ] No imports from MCP-files/ external paths (clean builds)\n- [ ] Unified memory backend serving all tool suites (consistency)\n- [ ] Sequential entry passes E2E scripts without regressions (stability)\n- [ ] Beta entry preserved and functional as fallback (safety)\n\n**Performance Requirements (Memory Domain)**:\n- Memory store operations: <1000ms\n- Memory search operations: <400ms  \n- Protocol smoke test: <5s execution\n- Build validation: <30s\n- Server startup: <10s with memory system\n\n## DOMAIN-SPECIFIC RISK MITIGATION\n\n**Memory System Risks**:\n- **ChromaDB Availability**: JSON fallback operational, graceful degradation\n- **Adapter Unification**: Feature-flagged rollout with selective rollback\n- **Protocol Compliance**: Comprehensive testing before production deployment\n\n**Emergency Rollback (Memory Domain)**:\n```bash\n# MEMORY CRISIS ROLLBACK\nexport MCP_PROTOCOL_SAFE=false\nexport UNIFIED_MEMORY=false\n# Switch to beta entry: tsx src/index.beta.ts\n```\n\n## DOMAIN-SPECIFIC VALIDATION\n\n**Memory System Testing Strategy**:\n```bash\n# MEMORY INTEGRATION TESTING\nnpm test -- --testPathPattern=memory-integration\n\n# PROTOCOL COMPLIANCE TESTING\n./scripts/protocol-smoke-test.sh\n\n# E2E MEMORY WORKFLOWS\nNAMESPACE=student03 npm run test:e2e -- memory-workflows\n```\n\n---\n\n## EXECUTION INITIATION\n\n**CODEX CLI**: Begin systematic implementation of FIX-001 emergency consolidation using Process v3.3.2.1 two-part structure with complete aviation checklist discipline.\n\n**Sprint Execution**:\n- **Part 1 (Fixed)**: Template provides all systematic foundation automatically\n- **Part 2 (Variable)**: Focus on memory crisis domain-specific implementation\n- **Evidence Standard**: Complete quantitative validation with ≥0.8 confidence\n- **Quality Gates**: Systematic verification before each phase progression\n\n**Human Oversight**: Strategic decisions, rollback authority, end-of-day git coordination\n\n**Success Definition**: MCP-OCS memory system crisis resolved with production-ready unified architecture, complete Process v3.3.2.1 audit trail, and systematic rollback capabilities.\n\n---\n\n**PROCESS v3.3.2.1 COMPLIANT PROMPT READY FOR CODEX CLI DEPLOYMENT**\n\n**Template Integration Verified**: Part 1 (Fixed) + Part 2 (Variable) structure achieved  \n**Aviation Checklist Discipline**: Zero deviation tolerance maintained  \n**Scrum Master Load**: Reduced to domain-specific context only  \n**Sprint Readiness**: Complete systematic foundation with memory crisis bounded tasks