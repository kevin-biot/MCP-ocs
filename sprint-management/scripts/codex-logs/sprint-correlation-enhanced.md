# Sprint Correlation Report
- Window: 2025-09-10T00:42:32.203Z → 2025-09-11T00:42:32.203Z
- Correlation window: 180s
- Claude events: 14 • Codex events: 206
- Correlated pairs: 0
- Lag (ms): median=n/a p95=n/a

## Unpaired Claude Writes/Patches (top)
- /Users/kevinbrown/MCP-ocs/sprint-management/TEMPLATE-USAGE-GUIDE-PROCESS-V3.3.2.md (2)
- /Users/kevinbrown/MCP-ocs/sprint-management/process/Process-v3.3.2-Update-Daily-Template-Integration.md (2)
- /Users/kevinbrown/MCP-ocs/sprint-management/templates/execution-log-codex-v3.3.2-template.md (1)
- /Users/kevinbrown/MCP-ocs/sprint-management/active/FIX-001-execution-log-codex.md (1)
- /Users/kevinbrown/MCP-ocs/sprint-management/active/FIX-001-codex-cli-prompt.md (1)
- /Users/kevinbrown/MCP-ocs/sprint-management/templates/daily-repeatable-task-template-v3.3.2.md (1)
- /Users/kevinbrown/MCP-ocs/sprint-management/active/FIX-001-codex-cli-prompt-v3.3.2.1.md (1)
- /Users/kevinbrown/MCP-ocs/sprint-management/active/FIX-001-codex-cli-prompt-v3.3.2.1-FIXED.md (1)
- /Users/kevinbrown/MCP-ocs/sprint-management/maintenance/backlog/FEATURE-002-universal-memory-integration.md (1)
- /Users/kevinbrown/MCP-ocs/sprint-management/docs/requirements/sprint-backlog-archive-requirements-v1.0.md (1)

## Unpaired Codex Patches (top)
- docs/reports/technical/issues/post-fix-vector-collections-issue-2025-09-10.md\n+Title: Post-fix: Vector collections v2, incident lifecycle, and enrichment rollout\n+\n+Type: enhancement\n+Labels: enhancement, vector-memory, collections, orchestration, post-fix\n+\n+Summary\n+Build on the MCP-OCS foundation refactor to introduce production-grade vector collections, structured incident lifecycle, and controlled AutoMemorySystem enrichment.\n+\n+Blocked by\n+- #31 Vector memory issue — collection strategy, schema v2, and orchestration enrichment (recommendations and base readiness)\n+- Foundation phases: Protocol safety, remove external dependency, unify backend, import hardening, validation (see readiness report)\n+\n+Scope\n+1) Collections & Isolation\n+- Defaults: `CHROMA_TENANT=mcp-ocs`, `CHROMA_DATABASE=prod`, `CHROMA_COLLECTION=ocs_memory_v2` (configurable)\n+- Partitioning: either separate collections (conversations/operational/tool_exec) or single unified with mandatory `kind:` tag and strict filters\n+\n+2) Schema v2 (unified)\n+- Required tags: `kind:<conversation|operational|tool_exec>`, `domain:<...>`, `environment:<...>`\n+- Optional tags: `tool:<name>`, `suite:<name>`, `resource:<type>`, `severity:<level>`\n+- IDs: `<kind>_<sessionOrIncident>_<timestamp>`; arrays stored as arrays in JSON and comma-joined in Chroma metadata (rehydrate on read)\n+\n+3) Incident Lifecycle Tools\n+- `memory_begin_incident`, `memory_append_evidence`, `memory_add_hypothesis`, `memory_publish_rca`, `memory_close_incident`\n+- Diagnostics/Read-ops tools write `tool_exec` evidence with normalized fields and dedup hash\n+\n+4) AutoMemorySystem Rollout (flagged)\n+- Start with `oc_diagnostic_pod_health` allowlist → then namespace health, RCA checklist, select read-ops\n+- Bounds: topK=3, timeout=400ms, summary≤1.5KB; stderr count-only logs; fallback to empty\n+\n+5) Stats & Visibility\n+- `memory_get_stats?detailed=true` returns vector totals and by-kind/collection counts plus tenant/database/collection identifiers\n+\n+Acceptance Criteria\n+- Vector collections isolated by tenant/database/collection; no mixing with MCP-files by default\n+- Unified schema v2 enforced on new writes; v1/v2 tolerant readers; optional reindex script available\n+- Incident lifecycle tools present and usable end-to-end; evidence written on tool execs\n+- AutoMemorySystem enrichment active for allowlisted tools, within performance bounds, no protocol leakage\n+- Stats show both JSON and vector counts, by kind/collection\n+\n+References\n+- Readiness report: docs/reports/technical/mcp-ocs-memory-system-consolidation-report-2025-09-10.md\n+- Enrichment pilot: docs/reports/technical/memory-enrichment-pilot-design-2025-09-10.md\n+- Vector memory base issue: docs/reports/technical/issues/vector-memory-issue-2025-09-10.md\n+\n*** End Patch"]} (1)
- docs/reports/technical/issues/configuration-system-enhancement-2025-09-10.md\n+Title: Enhancement: Configuration system (file-based profiles, env overrides, validation)\n+\n+Type: enhancement\n+Labels: enhancement, config, ops, production\n+\n+Summary\n+Introduce a production-friendly configuration system for MCP-OCS: file-based profiles with environment overrides and minimal CLI switches, plus typed validation at startup. This reduces env sprawl, improves reproducibility, and simplifies ops.\n+\n+Goals\n+- Single source of truth in `config/` with dev/staging/prod profiles\n+- Clear precedence: CLI > ENV > Config file > Defaults\n+- Typed schema + validation; fail-fast before server connect\n+- Safe defaults: `strictStdioLogs=true`, JSON-only fallback works by default\n+\n+Load Order (Precedence)\n+1) CLI flags (e.g., `--config`, `--profile`, targeted overrides)\n+2) Environment variables (CI/CD, container runtime)\n+3) Config file (YAML/TOML/JSON)\n+4) Built-in defaults\n+\n+Config Files\n+- Default: `config/mcp-ocs.config.yaml`\n+- Profiles: `config/mcp-ocs.config.dev.yaml`, `.staging.yaml`, `.prod.yaml`\n+- Discovery: `MCP_OCS_CONFIG=/path/file.yaml` and CLI `--config /path/file.yaml`\n+- Kubernetes: mount ConfigMap (non-secrets) + Secret/manager for sensitive values\n+\n+Schema (proposed)\n+```yaml\n+environment: dev|staging|prod\n+logging:\n+  strictStdioLogs: true\n+  verbose: false\n+memory:\n+  sharedMemoryDir: ./memory\n+  unifiedMemory: false\n+  chroma:\n+    host: 127.0.0.1\n+    port: 8000\n+    tenant: mcp-ocs\n+    database: dev\n+    collection: ocs_memory_v2\n+    forceJson: false\n+orchestration:\n+  enableOrchContext: false\n+  mode: hybrid\n+  topK: 3\n+  timeoutMs: 400\n+  summaryBytes: 1500\n+  toolsAllowlist: [oc_diagnostic_pod_health]\n+retention:\n+  jsonDays: 30\n+  vectorTtlDays: 60\n+collections:\n+  conversations: ocs_conversations\n+  operational: ocs_operational\n+  toolExec: ocs_tool_exec\n+```\n+\n+Env Integration\n+- Support `.env` and `.env.local` (dotenv) with expansion (dotenv-expand)\n+- Map env → config keys (doc matrix). Examples:\n+  - `CHROMA_HOST` → `memory.chroma.host`\n+  - `UNIFIED_MEMORY` → `memory.unifiedMemory`\n+  - `ENABLE_ORCH_CONTEXT` → `orchestration.enableOrchContext`\n+\n+Validation\n+- Use a schema (Zod/convict) to validate at startup (enums, ranges)\n+- On invalid config: print a single clear error and exit non-zero (before server connect)\n+\n+CLI Touchpoints\n+- `--config /path/file.yaml` (override path)\n+- `--profile prod` (auto-select profile file)\n+- Targeted overrides minimal (e.g., `--enable-orch-context`)\n+\n+Secrets Handling\n+- Keep secrets out of files; use env or secret manager\n+- Allow env substitution in YAML: `${OPENAI_API_KEY}` patterns\n+\n+Migration Plan\n+1) Add loader: read config file + `.env` + env; compute merged config with precedence\n+2) Move direct `process.env.*` lookups behind loader in entry points\n+3) Add profiles and runtime validation; fail-fast on invalid config\n+4) CI smoke using dev config; containers mount prod config + required env secrets\n+\n+Acceptance Criteria\n+- Server starts using a file-based config with overrides and validation\n+- Entry points read from loader (no scattered env reads)\n+- Defaults are safe; JSON-only mode works if Chroma is absent\n+- Documentation includes sample profiles and override rules\n+\n+References\n+- Readiness report: `docs/reports/technical/mcp-ocs-memory-system-consolidation-report-2025-09-10.md`\n+- Enrichment pilot: `docs/reports/technical/memory-enrichment-pilot-design-2025-09-10.md`\n+- Vector memory issue: #31; Post-fix enhancement: #32\n+\n*** End Patch"]} (1)
- docs/reports/technical/issues/process-3-3-sprint-management-enhancement-2025-09-10.md\n+Title: Process 3.3: Sprint management refinement (post-sprint assessment and guardrails)\n+\n+Type: enhancement\n+Labels: enhancement, process, scrum, sprint\n+\n+Summary\n+Run the current sprint using the existing process (3.2), then capture gaps and codify a lean Process 3.3 that keeps momentum while adding guardrails for AI-led sprints (Claude Scrum Master + Codex Dev/Tester). Focus on templates and rituals that improve outcomes without slowing coding.\n+\n+Context\n+- Avoid process paralysis: keep 3.3 short (1–2 pages), easy to adopt (< 90 min), and default to coding when inputs are sufficient.\n+- Use 3.2 for the next sprint as-is to generate real feedback; then refine.\n+\n+Goals\n+- Define a crisp Sprint Charter + Inputs checklist that the AI Scrum Master can enforce at kickoff.\n+- Add guardrails for protocol safety, feature flags, and file-scope limits.\n+- Standardize plan updates (one in_progress step), preamble etiquette, and checkpoint summaries.\n+- Provide a tiny Exit Checklist (Definition of Done) and a Retro template to capture improvements.\n+\n+Scope (deliverables)\n+1) PROCESS_3.3.md (1–2 pages):\n+   - Sprint Charter (Goal/Non-Goals/Timebox/WIP)\n+   - Inputs Checklist (Def. of Ready): issues, ACs, tests, rollback, flags, env/config, constraints\n+   - Roles: AI Scrum Master, AI Dev/Tester, Human PO/Reviewer\n+   - Kickoff script (10–15m): confirm scope, risks, exit criteria\n+   - Guardrails: protocol stdout ban, beta isolation, flags default-off, file scope\n+   - Execution workflow: update_plan usage, preambles, evidence logging\n+   - Exit Checklist: ACs, tests, smoke, docs, rollback\n+2) Kickoff checklist (one page) Claude reads/runs at sprint start\n+3) Scope-change ledger + decision log mini-templates\n+4) Retro form (brief, focused on impact over ceremony)\n+\n+Non-Goals\n+- No heavy process framework or tooling migration\n+- No rigid ceremony that blocks coding; prefer defaults and checklists\n+- No change to current sprint (3.2) beyond capturing data for 3.3\n+\n+Acceptance Criteria\n+- PROCESS_3.3.md, kickoff checklist, ledger/decision templates, and retro form drafted and merged\n+- Adopted in a pilot sprint; checkpoint and closeout summaries captured\n+- Retro outcomes feed a small backlog of process tweaks (label: process-debt)\n+\n+Success Measures\n+- Time-to-first-PR ≤ same as 3.2\n+- Fewer scope drifts (tracked via scope-change ledger)\n+- Protocol violations reduced (stdout smoke always run)\n+\n+References\n+- Readiness report: docs/reports/technical/mcp-ocs-memory-system-consolidation-report-2025-09-10.md\n+- Day‑1 TODO: docs/reports/technical/mcp-ocs-memory-system-consolidation-todo-2025-09-10.md\n+- Enrichment pilot: docs/reports/technical/memory-enrichment-pilot-design-2025-09-10.md\n+- Vector memory issues: #31, #32\n+- Config enhancement: #33\n+\n*** End Patch"],"with_escalated_permissions":false} (1)
- tools/ast-grep/no-stdout.yml\n+id: no-stdout\n+message: Avoid stdout logging (console.log/info); use stderr and protocol-safe logging.\n+severity: warning\n+language: TypeScript\n+rule:\n+  pattern: console.$C($A)\n+  metavars:\n+    $C:\n+      regex: \"^(log|info)$\"\n+\n*** End Patch"]} (1)
- tools/ast-grep/external-mcp-files.yml\n+id: external-mcp-files-import\n+message: Disallow imports from external MCP-files paths; use in-repo client instead.\n+severity: warning\n+language: TypeScript\n+rule:\n+  pattern: import $S from \"$P\"\n+  metavars:\n+    $P:\n+      regex: \"MCP-files/\"\n+\n*** End Patch"]} (1)
- tools/ast-grep/path-alias.yml\n+id: path-alias-at\n+message: '@/…' imports require resolver or refactor to relative paths.\n+severity: warning\n+language: TypeScript\n+rule:\n+  pattern: import $S from \"@/$REST\"\n+\n*** End Patch"]} (1)
- tools/ast-grep/env-reads.yml\n+id: direct-env-reads\n+message: Route env reads via the config loader instead of direct process.env.\n+severity: info\n+language: TypeScript\n+rule:\n+  pattern: process.env.$V\n+\n*** End Patch"]} (1)
- tools/ast-grep/auto-memory-retrieve.yml\n+id: auto-memory-retrieve-guard\n+message: AutoMemory retrieve should be behind flags/timeout; verify callsites.\n+severity: info\n+language: TypeScript\n+rule:\n+  pattern: autoMemory.retrieveRelevantContext($$ARGS)\n+\n*** End Patch"]} (1)
- tmp/astgrep-sample.ts\n+// Sample file for ast-grep testing only (not part of build)\n+import foo from \"@/lib/x\";\n+\n+console.log(\"hello\");\n+console.info(\"info\");\n+console.error(\"err\");\n+\n+const t = process.env.TEST_FLAG;\n+\n+async function demo(autoMemory: any) {\n+  await autoMemory.retrieveRelevantContext(\"tool\", { a: 1 }, \"sess\");\n+}\n+\n+export default foo;\n+\n*** End Patch"]} (1)
- docs/reports/quality/ast-grep-weekly-review-checklist.md\n+# AST-grep Weekly Review – Checklist (Read-Only)\n\nPurpose: Run a non-blocking code health scan outside coding sprints, capture findings, and curate a small quality backlog without disrupting active work.\n\n## Prep (5m)\n- [ ] Ensure ast-grep (`sg`) is installed and on PATH (`sg -V`).\n- [ ] Confirm rule pack location: `tools/ast-grep/*.yml`.\n- [ ] Choose a baseline branch (e.g., `main`) for context.\n\n## Run (10–15m)\n- [ ] Repository root\n- [ ] Command (plain output):\n  - `sg scan -r tools/ast-grep > docs/reports/quality/ast-grep-weekly-YYYY-MM-DD.txt`\n- [ ] Optional (GitHub format for ad-hoc CI or PR notes):\n  - `sg scan -r tools/ast-grep --format=github`\n\n## Focus Areas (triage lens)\n- Protocol safety: stdout usage (console.log/info) in server/runtime paths\n- External dependencies: MCP-files imports (should be removed)\n- Path hygiene: '@/…' imports (resolver or refactor to relative)\n- Config discipline: direct `process.env.*` reads (move behind loader)\n- Memory enrichment: unguarded `AutoMemorySystem.retrieveRelevantContext(...)`\n\n## Triage (15–20m)\n- [ ] Skim the weekly report; group by rule and severity\n- [ ] Classify findings:\n  - Keep (quality backlog): clear, scoped improvements\n  - Ignore (benign): tests/CLI-only or accepted exceptions\n  - Escalate (urgent): protocol break risks, production hazards\n- [ ] Create/append issues with labels (examples): `quality`, `ast-grep`, `protocol`, `config`, `memory`\n- [ ] Link each issue to the weekly report file\n\n## Outcome\n- [ ] Weekly report saved under `docs/reports/quality/`\n- [ ] ≤ 5 small quality issues created (scoped and actionable)\n- [ ] Zero disruptions to current sprint scope\n\n## Notes\n- Start as warn-only; later promote selected rules to daily reviewer, then to coding gates.\n- Prefer improving rule specificity over adding many rules.\n\n*** End Patch"]} (1)