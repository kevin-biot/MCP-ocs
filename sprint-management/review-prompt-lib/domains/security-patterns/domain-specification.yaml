domain:
  name: "security-patterns"
  version: "1.0"
  description: "Detect insecure implementation patterns in authentication, authorization, cryptography, and secret management"
  maintainer: "Quality Engineering Team"
  last_updated: "2025-09-05"
  
review:
  prompt_version: "v1.0"
  estimated_duration: "25-35 minutes"
  file_patterns:
    - "src/**/*.ts"
    - "src/**/*.js"
    - "!src/**/*.test.ts"
    - "!src/**/*.spec.ts"
    - "!src/**/__tests__/**"
    - "!src/**/*.mock.ts"
    - "!src/**/*.config.ts"
  llm_requirements:
    - "code-analysis"
    - "pattern-detection"
    - "security-knowledge"
    - "cryptography-understanding"
    - "typescript-understanding"

severity_levels:
  P0:
    name: "Critical"
    description: "Block merge immediately - Critical security pattern violation"
    sla: "Fix within 2 hours"
    escalation: "Page security team + on-call engineer"
    action: "BLOCK_MERGE"
  P1:
    name: "High"  
    description: "Fix within current sprint - High security risk pattern"
    sla: "Fix within 1 day"
    escalation: "Security team notification + sprint priority"
    action: "FIX_THIS_SPRINT"
  P2:
    name: "Medium"
    description: "Security debt - insecure but not immediately exploitable"
    sla: "Fix within 1 week"
    escalation: "Security sprint allocation"
    action: "SECURITY_DEBT"
  P3:
    name: "Low"
    description: "Security hygiene - improve pattern usage"
    sla: "Fix when touching related code"
    escalation: "Code review reminder"
    action: "OPPORTUNISTIC_FIX"

categories:
  weak-cryptography:
    description: "Use of deprecated or weak cryptographic algorithms"
    typical_effort: "60-120 minutes"
    risk_level: "critical"
    examples: 
      - "MD5 or SHA1 for password hashing"
      - "hardcoded cryptographic keys"
      - "weak random number generation"
  insecure-authentication:
    description: "Authentication implementation vulnerabilities"
    typical_effort: "90-180 minutes" 
    risk_level: "critical"
    examples:
      - "password stored in plaintext"
      - "session tokens without expiration"
      - "missing rate limiting on login"
  authorization-bypass:
    description: "Authorization checks that can be circumvented"
    typical_effort: "45-90 minutes"
    risk_level: "high"
    examples:
      - "client-side only authorization"
      - "inconsistent permission checking"
      - "role elevation without verification"
  secret-exposure:
    description: "Cryptographic secrets or credentials exposed in code"
    typical_effort: "30-60 minutes"
    risk_level: "high" 
    examples:
      - "API keys hardcoded in source"
      - "database passwords in configuration"
      - "JWT secrets in version control"
  timing-attacks:
    description: "Code vulnerable to timing-based attacks"
    typical_effort: "45-90 minutes"
    risk_level: "medium"
    examples:
      - "non-constant time string comparison"
      - "early return in authentication"
      - "response time reveals information"

integration:
  backlog_domain: "d-009-security-patterns"
  task_prefix: "SEC"
  sprint_estimation:
    P0: "4-8 hours"
    P1: "2-4 hours"
    P2: "1-2 hours" 
    P3: "30-60 minutes"
  auto_actions:
    - "create_tasks_for_new_findings"
    - "mark_resolved_when_not_found"
    - "escalate_persistent_p0_after_2_hours"
    - "escalate_persistent_p1_after_8_hours"
    - "notify_security_team_for_p0_p1"

quality_gates:
  clean_threshold:
    P0: 0  # Zero P0 issues to be considered "clean"
    P1: 0  # Zero P1 issues for security patterns
    P2: 1  # Maximum 1 P2 issue acceptable
  regression_detection:
    enabled: true
    alert_on_new_p0: true
    alert_on_new_p1: true
    alert_on_p2_increase: true
  trend_analysis:
    track_resolution_time: true
    track_recurrence_rate: true
    security_report: true

tooling:
  compatible_llms:
    - "qwen"
    - "claude-3"
    - "gpt-4"
    - "codellama"
  output_validation:
    required_fields: ["fingerprint", "severity", "category", "file", "line", "description", "evidence", "recommendation", "security_impact", "cve_references"]
    fingerprint_pattern: "^security-patterns:[^:]+:[0-9]+:(weak-cryptography|insecure-authentication|authorization-bypass|secret-exposure|timing-attacks):[a-z0-9]{8}$"
    fingerprint_components:
      - "domain: security-patterns"
      - "file: relative path from repo root"
      - "line: line number where issue occurs"
      - "category: issue type"
      - "content_hash: 8-char hash of normalized code evidence"
